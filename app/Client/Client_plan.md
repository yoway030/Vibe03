# Client 모듈 개발 계획

## 모듈 개요
Physics 모듈을 사용하여 게임 기능 구현.
해당 모듈은 라이브러리가 아닌 자체가 실행파일.

## 개발 목표
- 100000×100000 크기의 작은 네모 영역 상자로 이루어진 공간. 중력은 존재하지 않는다.
- 영역의 중심을 기준으로 원을 그리고 그 원 위에 동일한 거리가 떨어진 100개의 대포가 있다.
- 각 대포는 중심 방향을 기준으로 좌우로 돌아가면서 일정시간 마다 포탄을 발사한다.
- 포탄에 맞은 영역 상자는 그 포탄을 발사한 대포의 영역이 된다.
- 대포와 동일한 영역의 상자는 그 대포가 발사한 포탄과 충돌하지 않는다.
- 100개의 대포는 100개의 영역을 대표한다.
- 각 영역은 고유의 색상을 갖고, 자신의 영역을 넓히기 위해서 노력한다.
- 영역을 넓힐 때마다 1점을 얻고, 다른 대포의 영역을 자신의 영역으로 만들때 2점을 얻는다.
- 점수를 활용해서 여러가지 스킬을 사용해서 영역을 빠르게 넓힌다.

## 구성
- 랜더링과 게임로직, 물리로직은 완벽히 분리되어 있어야 한다.
- 랜더링 속도에 게임로직과 물리로직이 영향을 받지 않아야 한다.
- 충돌처리는 이동경로를 기준으로 정확히 계산되어야 한다.

## 정의
- 대포의 기본 포탄 공격력: 1.0f
- 영역 상자의 내구도: 1.0f
- 영역 상자의 크기: 가로세로 500.0f (성능 최적화)
- 포탄에 맞으면 영역상자의 내구도는 공격력 만큼 줄어든다.
- 영역상자의 내구도가 0이 되면, 0으로 만든 포탄의 대포의 영역이 된다.
- 포탄은 자신의 영역을 통과하여 계속 날아간다. (범위 제한 없음)

## 현재 구현 상태 (2026-02-03)

### 월드 설정
- WorldSize: 100000 (100000×100000 공간)
- CannonRadius: 45000 (대포 배치 원의 반지름)
- CellSize: 500 (영역 상자 크기)
- GridSize: 200×200 = 40,000 셀
- CannonCount: 100개

### 렌더링 최적화
- 멀티스레드 아키텍처: GameSimulationThread (60Hz 고정) + Renderer (GameState 스냅샷 소비)
- 탐욕적 사각형 병합 알고리즘(Greedy Rectangle Merging LOD) 적용
  - GameSimulation에서 영역 변경 시에만 병합 계산 (RebuildMergedRegions)
  - 병합 결과를 GameState 스냅샷에 포함
  - Renderer는 사전 계산된 병합 영역 사용 (매 프레임 계산 제거)
- 픽셀 오버랩 렌더링으로 검은 선 제거 (-0.5f 오프셋, +1.0f 크기)
- 모든 외곽선 제거 (게임 테두리, 대포, 포탄, 헬퍼)

### 충돌 최적화
- 2단계 충돌 검사 시스템:
  1. 병합된 영역(MergedRegion) AABB 체크 (수천 개)
  2. 히트된 병합 영역 내에서 정확한 셀 찾기
- MergedRegion 클래스: OwnerId, StartX/Y, Width/Height, WorldMin/Max (AABB)
- 자기 영역과의 충돌 스킵으로 성능 향상

### 시각적 개선
- 대포 포신 길이: CellSize × 2.5f
- 포탄 발사 위치: 포신 끝에서 생성
- 폭발 이펙트 추가

### 게임플레이
- 점수 시스템 구현:
  - 중립 영역 점령: +1점
  - 적 영역 탈취: +2점
- 내구도/데미지 시스템: 1.0f
- 대포 좌우 회전 시스템

## 스킬 (미구현)
- 자신의 포탄을 3배로 복사해 주는 블럭을 설치한다.
- 대포의 발사 속도를 증가 시킨다.
- 일정확률로 공격력 10, 관통 속성이 있는 포탄을 발사 한다.

## 향후 개선 사항
- [ ] 스킬 시스템 구현
- [ ] 더 다양한 시각 효과
- [ ] 성능 모니터링 UI
- [ ] 대포별 통계 및 순위표